<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<f:view transient="true">
    <f:metadata>
        <f:viewAction action="#{tableauDeBord.recupererDataPourStatistiques}" onPostBack="true"/>
    </f:metadata>
    <h:head>
        <title>Tableau de bord</title>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF8" />
        <h:outputStylesheet name="css/tableaudebord.css" />
        <h:outputScript name="bootstrap/js/bootstrap.js" />
        <h:outputStylesheet name="bootstrap/css/bootstrap.css" />
        <h:outputScript name="chartjs/js/Chart.js"/>
        <h:outputScript name="chartjs/js/Chart.min.js"/>
        <h:outputStylesheet name="chartjs/css/Chart.css" />
        <h:outputStylesheet name="chartjs/css/Chart.min.css" />
    </h:head>
    <h:body>
        <div class="container-fluid" style="margin-bottom: 50px">
            <div class="row">
                <div id="header">
                    <ui:insert name="header" >
                        <ui:include src="header.xhtml" />
                    </ui:insert>
                </div>
                <div id="footer">
                    <ui:insert name="footer" >
                        <ui:include src="footer.xhtml" />
                    </ui:insert>
                </div>
                <div class="main-overview" style="margin-bottom: 50px; margin-top: 10px">
                    <div class="col-sm-10 col-md-12 main">
                        <div class="column" style=" width: 15%">
                            <ui:include src="sidebar.xhtml" />
                        </div>
                        <div class="column" style=" width:80%; margin-right: 10px">
                            <h1 class="page-header"><h:graphicImage value="./resources/images/speedometer.png" />Tableau de bord</h1>

                            <div class="notice notice-success" style="margin-top: 10px">
                                <strong>Vous êtes un agent de  : </strong> #{tableauDeBord.user.userDirection}
                            </div>

                            <div class="stylecourrierdujour">

                                <div class="gridbox" style="background-color: #53A9F1">
                                    <div class="gridbox_icon"><h:graphicImage value="./resources/images/courrierrecu.png" /></div>
                                    <div class="gridbox_info"  style="color: white; font-size: 14px">Courriers reçu aujourd'hui : #{tableauDeBord.statistiques.nombreDeCourrierRecusDuJour}</div>
                                </div>

                                <div class="gridbox" style="background-color: #6FBC6F">
                                    <div class="gridbox_icon"><h:graphicImage value="./resources/images/courrierenvoye.png" /></div>
                                    <div class="gridbox_info" style="color: white; font-size: 14px">Courriers envoyés aujourdhui  : #{tableauDeBord.statistiques.nombreDeCourrierEnvoyesDuJour} </div>
                                </div>

                                <div class="gridbox" style="background-color: #F9AE2E">
                                    <div class="gridbox_icon"><h:graphicImage value="./resources/images/important.png" /></div>
                                    <div class="gridbox_info" style="color: white; font-size: 14px">Courriers urgent du jour :  #{tableauDeBord.statistiques.nombreDeCourrierUrgentDuJour}</div>
                                </div>

                                <div class="gridbox" style="background-color: #F86B8F">
                                    <div class="gridbox_icon"><h:graphicImage value="./resources/images/padlock.png" /></div>
                                    <div class="gridbox_info" style="color: white; font-size: 14px">Courriers confidentiel du jour : #{tableauDeBord.statistiques.nombreDeCourrierConfidentielDuJour}</div>
                                </div>
                            </div>

                            <div class="lignechart" style="margin-left: 10px; margin-top: 30px">

                                <div class="chartbox">
                                    <div class="chartboxcontent">
                                        <h5 style="font-weight: bold; font-size: 13px">Nombre de courriers entrants et sortant traités le mois courant</h5>
                                        <canvas id="courrierEntrantEtSortant" width="290" height="203"></canvas>
                                    </div>
                                </div>

                                <div class="chartbox">
                                    <div class="chartboxcontent">
                                        <h5 style="font-weight: bold; font-size: 13px">Nombre de courriers traités par priorité le mois courant</h5>
                                        <canvas id="courriersTraitesParUrgence" width="290" height="203"></canvas>
                                    </div>

                                </div>


                                <div class="chartboxtype">
                                    <div class="chartboxcontent">
                                        <h5 style="font-weight: bold; font-size: 13px">Nombre de courriers traités par direction du ministère le mois courant</h5>
                                        <canvas id="courriersTraitesParType" width="290" height="110"></canvas>
                                    </div>

                                </div>
                            </div>


                            <div class="lignechart" style="margin-left: 10px; margin-top: 30px">
                                <div class="discussionbox">
                                    <p:panel toggleable="true" id="sports" header="Vos Dernieres disussions en cours">
                                        <ui:repeat  value="#{tableauDeBord.discussion.listeDiscussionsOuvertes}"  var="discussionEtape">
                                            <h:form >
                                                <h:panelGrid columns="2" columnClasses="ui-grid-col-1, ui-grid-col-10" style="width:100%">
                                                    <h:graphicImage value="./resources/images/user.png"  style=" margin-left: 5px; margin-top: -30px"/>
                                                    <h:panelGrid columns="1" style="width: 100%">
                                                        <h:outputText value="#{discussionEtape.messageDiscussion}" style="font-size: 13px; color: #0f0f0f"/>
                                                        <h:outputText style="color: #777777; font-size: 11px; margin-top: 5px" value="#{discussionEtape.dateDiscussion}"/>
                                                        <p:commandButton  icon="fa fa-eye" ajax="false"
                                                                          action="#{tableauDeBord.accederALEtapeDUneDiscussion}"
                                                                          style="background: #496ea1; border: 1px #496ea1 solid; float: right"
                                                                          title="Voir">
                                                            <f:param name="idDiscussion" value="#{discussionEtape.idDiscussion}" />
                                                            <f:param name="etatCorrespondanceEtape" value="#{discussionEtape.etatCorrespondanceEtape}" />
                                                        </p:commandButton>
                                                    </h:panelGrid>
                                                </h:panelGrid>
                                                <p:separator/>
                                            </h:form>
                                        </ui:repeat>
                                    </p:panel>
                                </div>
                                <div class="discussionbox">
                                    <p:panel toggleable="true" header="Vos Dernieres taches en cours traitement">
                                        <ui:repeat  value="#{tableauDeBord.etape.listeDeMesTachesEnTraitement}"  var="etape">
                                            <h:form id="form">
                                                <h:panelGrid columns="2" columnClasses="ui-grid-col-1, ui-grid-col-10" style="width:100%">
                                                    <h:graphicImage value="./resources/images/entraitement.png"  style=" margin-left: 5px; margin-top: -30px"/>
                                                    <h:panelGrid columns="1" style="width: 100%">
                                                        <h:outputText value="#{etape.message}" escape="false" style="font-size: 13px; color: #0f0f0f"/>
                                                        <h:outputText style="color: #777777; font-size: 11px; margin-top: 5px" value="#{etape.date_debut}"/>
                                                        <p:commandButton  icon="fa fa-eye" action="#{tableauDeBord.voirUneTache}" ajax="false"
                                                                          style="background: #496ea1; border: 1px #496ea1 solid; float: right"
                                                                          title="Voir">
                                                            <f:param name="etapeId" value="#{etape.id}" />
                                                            <f:param name="natureEtape" value="#{etape.nature}" />
                                                        </p:commandButton>
                                                    </h:panelGrid>
                                                </h:panelGrid>
                                            <p:separator/>
                                            </h:form>
                                        </ui:repeat>
                                    </p:panel>
                                </div>
                            </div>

                            <p:dialog id="alfrescoMessage"
                                      header="Erreur sur le serveur de fichier"
                                      widgetVar="dialogueAlfrescoMessage"
                                      modal="true" hideEffect="clip"
                                      showEffect="clip"
                                      resizable="false">
                                <div class="alertealfrescooffline" style="width: 100%">
                                    <h:graphicImage value="./resources/images/alerteaccusedereception.png" style="margin-left:10px"/>
                                    Le serveur de fichier Alfresco ne réponds pas ou n'est pas allumé,<br />
                                    vous ne pourrez voir aucun fichier et/ou l'application risque de mal fonctionner
                                </div>
                                <p:separator/>
                                <h:form>
                                    <p:commandButton value="Ok"
                                                     type="button"
                                                     onclick="PF('dialogueAlfrescoMessage').hide()"
                                                     style="margin-top: 14px; margin-right: 10px"
                                                     icon="fa fa-check-circle"/>
                                </h:form>
                            </p:dialog>

                        </div>

                    </div>
                </div>
            </div>
        </div>
        <script>

            var courriersTraitesParUrgence = document.getElementById('courriersTraitesParUrgence');
            var courrierEntrantEtSortant = document.getElementById('courrierEntrantEtSortant');
            var courriersTraitesParType = document.getElementById('courriersTraitesParType');

            var myChart = new Chart(courriersTraitesParUrgence, {
                type: 'doughnut',
                data: {
                    labels: ['Courriers urgents', 'Courriers normaux', 'Courrier confidentiel'],
                    datasets: [{
                        label: '',
                        data: ['#{tableauDeBord.statistiques.nombreDeCourrierUrgentDuMois}', '#{tableauDeBord.statistiques.nombreDeCourrierPasUrgentDuMois}', '#{tableauDeBord.statistiques.nombreDeCourrierConfidentielDuMois}'],
                        backgroundColor: [
                            'rgba(249, 174, 46, 0.4)',
                            'rgba(54, 162, 235, 0.4)',
                            'rgba(248, 107, 143, 0.4)'
                        ],
                        borderColor: [
                            'rgba(249, 174, 46, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(248, 107, 143,1)'
                        ],
                        borderWidth:2,
                        hoverBorderWidth : 3,
                        hoverBorderColor : '#fef3ce'
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                display:false
                            }
                        }], legend : {
                            display:false
                        },
                    }
                }
            });

            var myChart3 = new Chart(courrierEntrantEtSortant, {
                type: 'doughnut',
                data: {
                    labels: ['Courriers reçus', 'Courriers envoyés'],
                    datasets: [{
                        label: '',
                        data: ['#{tableauDeBord.statistiques.nombreDeCourrierRecusDuMois}', '#{tableauDeBord.statistiques.nombreDeCourrierEnvoyesDuMois}'],
                        backgroundColor: [
                            'rgba(83, 169,241, 0.5)',
                            'rgba(113, 199, 170, 0.5)'
                        ],
                        borderColor: [
                            'rgba(83, 169,241, 1)',
                            'rgba(113, 199, 170, 1)'
                        ],
                        borderWidth:2,
                        hoverBorderWidth : 3,
                        hoverBorderColor : '#fef3ce'
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                               display:false
                            }
                        }], legend : {
                            display:false
                        },
                    }
                }
            });

            var myChart2 = new Chart(courriersTraitesParType, {
                type: 'bar',
                data: {
                    labels: ['#{tableauDeBord.typeCourrierUn}', '#{tableauDeBord.typeCourrierDeux}', '#{tableauDeBord.typeCourrierTrois}', '#{tableauDeBord.typeCourrierQuatre}', '#{tableauDeBord.typeCourrierCinq}', '#{tableauDeBord.typeCourrierSix}'],

                    datasets: [{
                        label: '',
                        data: ['#{tableauDeBord.valeurTypeCourrierUn}', '#{tableauDeBord.valeurTypeCourrierDeux}', '#{tableauDeBord.valeurTypeCourrierTrois}', '#{tableauDeBord.valeurTypeCourrierQuatre}', '#{tableauDeBord.valeurTypeCourrierCinq}', '#{tableauDeBord.valeurTypeCourrierSix}'],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.4)',
                            'rgba(54, 162, 235, 0.4)',
                            'rgba(255, 206, 86, 0.4)',
                            'rgba(75, 192, 192, 0.4)',
                            'rgba(153, 102, 255, 0.4)',
                            'rgba(255, 159, 64, 0.4)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth:2,
                        hoverBorderWidth : 3,
                        hoverBorderColor : '#fef3ce'
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    legend : {
                        display:false
                    },
                    tooltip: {
                        enable:true
                    }
                }
            });




        </script>

    </h:body>
</f:view>
</html>
